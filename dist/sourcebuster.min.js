!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.sbjs=e()}}(function(){return function e(r,s,t){function n(o,a){if(!s[o]){if(!r[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var p=s[o]={exports:{}};r[o][0].call(p.exports,function(e){var s=r[o][1][e];return n(s?s:e)},p,p.exports,e,r,s,t)}return s[o].exports}for(var i="function"==typeof require&&require,o=0;o<t.length;o++)n(t[o]);return n}({"./src/js/sourcebuster.js":[function(e,r,s){"use strict";var t=e("./init"),n={init:function(e){this.get=t(e),e&&e.callback&&"function"==typeof e.callback&&e.callback(this.get)}};r.exports=n},{"./init":"/Users/zlebnik/projects/sourcebuster-js/src/js/init.js"}],"/Users/zlebnik/projects/sourcebuster-js/src/js/data.js":[function(e,r,s){"use strict";var t=e("./terms"),n=e("./helpers/utils"),i={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(e){return i.aliases.main.type+"="+e.type+i.delimiter+i.aliases.main.source+"="+e.source+i.delimiter+i.aliases.main.medium+"="+e.medium+i.delimiter+i.aliases.main.campaign+"="+e.campaign+i.delimiter+i.aliases.main.content+"="+e.content+i.delimiter+i.aliases.main.term+"="+e.term},extra:function(e){return i.aliases.extra.fire_date+"="+n.setDate(new Date,e)+i.delimiter+i.aliases.extra.entrance_point+"="+document.location.href+i.delimiter+i.aliases.extra.referer+"="+(document.referrer||t.none)},user:function(e,r){return i.aliases.udata.visits+"="+e+i.delimiter+i.aliases.udata.ip+"="+r+i.delimiter+i.aliases.udata.agent+"="+navigator.userAgent},session:function(e){return i.aliases.session.pages_seen+"="+e+i.delimiter+i.aliases.session.current_page+"="+document.location.href},promo:function(e){return i.aliases.promo+"="+n.setLeadingZeroToInt(n.randomInt(e.min,e.max),e.max.toString().length)}}};r.exports=i},{"./helpers/utils":"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/utils.js","./terms":"/Users/zlebnik/projects/sourcebuster-js/src/js/terms.js"}],"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/cookies.js":[function(e,r,s){"use strict";var t=e("../data").delimiter,n="";r.exports={setPrefix:function(e){n=e},getPrefix:function(){return n},encodeData:function(e){return n+encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e.replace(new RegExp("^"+n),"")).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(r){try{return unescape(e)}catch(s){return""}}},set:function(e,r,s,t,n){var i,o;if(s){var a=new Date;a.setTime(a.getTime()+60*s*1e3),i="; expires="+a.toGMTString()}else i="";o=t&&!n?";domain=."+t:"",document.cookie=this.encodeData(e)+"="+this.encodeData(r)+i+o+"; path=/"},get:function(e){for(var r=this.encodeData(e)+"=",s=document.cookie.split(";"),t=0;t<s.length;t++){for(var n=s[t];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(r))return this.decodeData(n.substring(r.length,n.length))}return null},destroy:function(e,r,s){this.set(e,"",-1,r,s)},parse:function(e){var r=[],s={};if("string"==typeof e)r.push(e);else for(var n in e)e.hasOwnProperty(n)&&r.push(e[n]);for(var i=0;i<r.length;i++){var o;s[this.unsbjs(r[i])]={},o=this.get(r[i])?this.get(r[i]).split(t):[];for(var a=0;a<o.length;a++){var c=o[a].split("="),u=c.splice(0,1);u.push(c.join("=")),s[this.unsbjs(r[i])][u[0]]=this.decodeData(u[1])}}return s},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":"/Users/zlebnik/projects/sourcebuster-js/src/js/data.js"}],"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/uri.js":[function(e,r,s){"use strict";r.exports={parse:function(e){for(var r=this.parseOptions,s=r.parser[r.strictMode?"strict":"loose"].exec(e),t={},n=14;n--;)t[r.key[n]]=s[n]||"";return t[r.q.name]={},t[r.key[12]].replace(r.q.parser,function(e,s,n){s&&(t[r.q.name][s]=n)}),t},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(e){for(var r={},s=e?e:window.location.search.substring(1),t=s.split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if("undefined"==typeof r[i[0]])r[i[0]]=i[1];else if("string"==typeof r[i[0]]){var o=[r[i[0]],i[1]];r[i[0]]=o}else r[i[0]].push(i[1])}return r},getHost:function(e){return this.parse(e).host.replace("www.","")}}},{}],"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/utils.js":[function(e,r,s){"use strict";r.exports={escapeRegexp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(e,r){var s=e.getTimezoneOffset()/60,t=e.getHours(),n=r||0===r?r:-s;e.setHours(t+s+n);var i=e.getFullYear(),o=this.setLeadingZeroToInt(e.getMonth()+1,2),a=this.setLeadingZeroToInt(e.getDate(),2),c=this.setLeadingZeroToInt(e.getHours(),2),u=this.setLeadingZeroToInt(e.getMinutes(),2),p=this.setLeadingZeroToInt(e.getSeconds(),2);return i+"-"+o+"-"+a+" "+c+":"+u+":"+p},setLeadingZeroToInt:function(e,r){for(var s=e+"";s.length<r;)s="0"+s;return s},randomInt:function(e,r){return Math.floor(Math.random()*(r-e+1))+e}}},{}],"/Users/zlebnik/projects/sourcebuster-js/src/js/init.js":[function(e,r,s){"use strict";var t=e("./data"),n=e("./terms"),i=e("./helpers/cookies"),o=e("./helpers/uri"),a=e("./helpers/utils"),c=e("./params"),u=e("./migrations");r.exports=function(e){function r(){var e;if("undefined"!=typeof j.utm_source||"undefined"!=typeof j.utm_medium||"undefined"!=typeof j.utm_campaign||"undefined"!=typeof j.utm_content||"undefined"!=typeof j.utm_term||"undefined"!=typeof j.gclid||"undefined"!=typeof j.yclid||"undefined"!=typeof j[h.campaign_param])g(),e=s(n.traffic.utm);else if(f(n.traffic.organic))g(),e=s(n.traffic.organic);else if(!i.get(t.containers.session)&&f(n.traffic.referral))g(),e=s(n.traffic.referral);else{if(i.get(t.containers.first)||i.get(t.containers.current))return i.get(t.containers.current);g(),e=s(n.traffic.typein)}return e}function s(e){switch(e){case n.traffic.utm:x=n.traffic.utm,_="undefined"!=typeof j.utm_source?j.utm_source:"undefined"!=typeof j.gclid?"google":"undefined"!=typeof j.yclid?"yandex":n.none,k="undefined"!=typeof j.utm_medium?j.utm_medium:"undefined"!=typeof j.gclid?"cpc":"undefined"!=typeof j.yclid?"cpc":n.none,w="undefined"!=typeof j.utm_campaign?j.utm_campaign:"undefined"!=typeof j[h.campaign_param]?j[h.campaign_param]:"undefined"!=typeof j.gclid?"google_cpc":"undefined"!=typeof j.yclid?"yandex_cpc":n.none,z=j.utm_content||n.none,U=p()||n.none;break;case n.traffic.organic:x=n.traffic.organic,_=_||o.getHost(document.referrer),k=n.referer.organic,w=n.none,z=n.none,U=n.none;break;case n.traffic.referral:x=n.traffic.referral,_=_||o.getHost(document.referrer),k=k||n.referer.referral,w=n.none,z=o.parse(document.referrer).path,U=n.none;break;case n.traffic.typein:x=n.traffic.typein,_=h.typein_attributes.source,k=h.typein_attributes.medium,w=n.none,z=n.none,U=n.none;break;default:x=n.oops,_=n.oops,k=n.oops,w=n.oops,z=n.oops,U=n.oops}var r={type:x,source:_,medium:k,campaign:w,content:z,term:U};return t.pack.main(r)}function p(){var e=document.referrer;if(j.utm_term)return j.utm_term;if(!(e&&o.parse(e).host&&o.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return o.getParam(o.parse(document.referrer).query).text}catch(r){return!1}}function f(e){var r=document.referrer;switch(e){case n.traffic.organic:return!!r&&l(r)&&m(r);case n.traffic.referral:return!!r&&l(r)&&d(r);default:return!1}}function l(e){if(h.domain){if(b)return o.getHost(e)!==o.getHost(y);var r=new RegExp("^(?:.*\\.)?"+a.escapeRegexp(y)+"$","i");return!o.getHost(e).match(r)}return o.getHost(e)!==o.getHost(document.location.href)}function m(e){var r="yandex",s="text",t="google",n=new RegExp("^(?:.*\\.)?"+a.escapeRegexp(r)+"\\..{2,9}$"),i=new RegExp(".*"+a.escapeRegexp(s)+"=.*"),c=new RegExp("^(?:www\\.)?"+a.escapeRegexp(t)+"\\..{2,9}$");if(o.parse(e).query&&o.parse(e).host.match(n)&&o.parse(e).query.match(i))return _=r,!0;if(o.parse(e).host.match(c))return _=t,!0;if(!o.parse(e).query)return!1;for(var u=0;u<h.organics.length;u++){if(o.parse(e).host.match(new RegExp("^(?:.*\\.)?"+a.escapeRegexp(h.organics[u].host)+"$","i"))&&o.parse(e).query.match(new RegExp(".*"+a.escapeRegexp(h.organics[u].param)+"=.*","i")))return _=h.organics[u].display||h.organics[u].host,!0;if(u+1===h.organics.length)return!1}}function d(e){if(!(h.referrals.length>0))return _=o.getHost(e),!0;for(var r=0;r<h.referrals.length;r++){if(o.parse(e).host.match(new RegExp("^(?:.*\\.)?"+a.escapeRegexp(h.referrals[r].host)+"$","i")))return _=h.referrals[r].display||h.referrals[r].host,k=h.referrals[r].medium||n.referer.referral,!0;if(r+1===h.referrals.length)return _=o.getHost(e),!0}}function g(){i.set(t.containers.current_extra,t.pack.extra(h.timezone_offset),v,y,b),i.get(t.containers.first_extra)||i.set(t.containers.first_extra,t.pack.extra(h.timezone_offset),v,y,b)}var h=c.fetch(e),j=o.getParam(),y=h.domain.host,b=h.domain.isolate,v=h.lifetime;i.setPrefix(h.prefix),u.go(v,y,b);var x,_,k,w,z,U;return function(){i.set(t.containers.current,r(),v,y,b),i.get(t.containers.first)||i.set(t.containers.first,i.get(t.containers.current),v,y,b);var e,s;i.get(t.containers.udata)?(e=parseInt(i.parse(t.containers.udata)[i.unsbjs(t.containers.udata)][t.aliases.udata.visits])||1,e=i.get(t.containers.session)?e:e+1,s=t.pack.user(e,h.user_ip)):(e=1,s=t.pack.user(e,h.user_ip)),i.set(t.containers.udata,s,v,y,b);var n;i.get(t.containers.session)?(n=parseInt(i.parse(t.containers.session)[i.unsbjs(t.containers.session)][t.aliases.session.pages_seen])||1,n+=1):n=1,i.set(t.containers.session,t.pack.session(n),h.session_length,y,b),h.promocode&&!i.get(t.containers.promocode)&&i.set(t.containers.promocode,t.pack.promo(h.promocode),v,y,b)}(),i.parse(t.containers)}},{"./data":"/Users/zlebnik/projects/sourcebuster-js/src/js/data.js","./helpers/cookies":"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/cookies.js","./helpers/uri":"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/uri.js","./helpers/utils":"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/utils.js","./migrations":"/Users/zlebnik/projects/sourcebuster-js/src/js/migrations.js","./params":"/Users/zlebnik/projects/sourcebuster-js/src/js/params.js","./terms":"/Users/zlebnik/projects/sourcebuster-js/src/js/terms.js"}],"/Users/zlebnik/projects/sourcebuster-js/src/js/migrations.js":[function(e,r,s){"use strict";var t=e("./data"),n=e("./helpers/cookies");r.exports={go:function(e,r,s){var i,o=this.migrations,a={l:e,d:r,i:s};if(n.get(t.containers.first)||n.get(t.service.migrations)){if(!n.get(t.service.migrations))for(i=0;i<o.length;i++)o[i].go(o[i].id,a)}else{var c=[];for(i=0;i<o.length;i++)c.push(o[i].id);var u="";for(i=0;i<c.length;i++)u+=c[i]+"=1",i<c.length-1&&(u+=t.delimiter);n.set(t.service.migrations,u,a.l,a.d,a.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(e,r){var s=e+"=1",i=e+"=0",o=function(e,r,s){return r||s?e:t.delimiter};try{var a=[];for(var c in t.containers)t.containers.hasOwnProperty(c)&&a.push(t.containers[c]);for(var u=0;u<a.length;u++)if(n.get(a[u])){var p=n.get(a[u]).replace(/(\|)?\|(\|)?/g,o);n.destroy(a[u],r.d,r.i),n.destroy(a[u],r.d,!r.i),n.set(a[u],p,r.l,r.d,r.i)}n.get(t.containers.session)&&n.set(t.containers.session,t.pack.session(0),r.l,r.d,r.i),n.set(t.service.migrations,s,r.l,r.d,r.i)}catch(f){n.set(t.service.migrations,i,r.l,r.d,r.i)}}},{id:"1471519752600",version:"1.0.5",go:function(e,r){var s=e+"=1",i=e+"=0",o="",a=n.getPrefix();try{n.setPrefix(o);var c=[];for(var u in t.containers)t.containers.hasOwnProperty(u)&&c.push(t.containers[u]);for(var p=0;p<c.length;p++)if(n.setPrefix(o),n.get(c[p])){var f=n.get(c[p]);n.setPrefix(a),n.set(c[p],f,r.l,r.d,r.i)}n.setPrefix(o),n.get(t.containers.session)&&(n.setPrefix(a),n.set(t.containers.session,t.pack.session(0),r.l,r.d,r.i)),n.setPrefix(a),n.set(t.service.migrations,s,r.l,r.d,r.i)}catch(l){n.set(t.service.migrations,i,r.l,r.d,r.i)}}}]}},{"./data":"/Users/zlebnik/projects/sourcebuster-js/src/js/data.js","./helpers/cookies":"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/cookies.js"}],"/Users/zlebnik/projects/sourcebuster-js/src/js/params.js":[function(e,r,s){"use strict";var t=e("./terms"),n=e("./helpers/uri");r.exports={fetch:function(e){var r=e||{},s={};if(s.prefix=this.validate.isString(r.prefix)?r.prefix:"",s.lifetime=this.validate.checkFloat(r.lifetime)||6,s.lifetime=parseInt(30*s.lifetime*24*60),s.session_length=this.validate.checkInt(r.session_length)||30,s.timezone_offset=this.validate.checkInt(r.timezone_offset),s.campaign_param=r.campaign_param||!1,s.user_ip=r.user_ip||t.none,r.promocode?(s.promocode={},s.promocode.min=parseInt(r.promocode.min)||1e5,s.promocode.max=parseInt(r.promocode.max)||999999):s.promocode=!1,r.typein_attributes&&r.typein_attributes.source&&r.typein_attributes.medium?(s.typein_attributes={},s.typein_attributes.source=r.typein_attributes.source,s.typein_attributes.medium=r.typein_attributes.medium):s.typein_attributes={source:"(direct)",medium:"(none)"},r.domain&&this.validate.isString(r.domain)?s.domain={host:r.domain,isolate:!1}:r.domain&&r.domain.host?s.domain=r.domain:s.domain={host:n.getHost(document.location.hostname),isolate:!1},s.referrals=[],r.referrals&&r.referrals.length>0)for(var i=0;i<r.referrals.length;i++)r.referrals[i].host&&s.referrals.push(r.referrals[i]);if(s.organics=[],r.organics&&r.organics.length>0)for(var o=0;o<r.organics.length;o++)r.organics[o].host&&r.organics[o].param&&s.organics.push(r.organics[o]);return s.organics.push({host:"bing.com",param:"q",display:"bing"}),s.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),s.organics.push({host:"about.com",param:"q",display:"about"}),s.organics.push({host:"aol.com",param:"q",display:"aol"}),s.organics.push({host:"ask.com",param:"q",display:"ask"}),s.organics.push({host:"globososo.com",param:"q",display:"globo"}),s.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),s.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),s.organics.push({host:"tut.by",param:"query",display:"tut.by"}),s.referrals.push({host:"t.co",display:"twitter.com"}),s.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),s},validate:{checkFloat:function(e){return!(!e||!this.isNumeric(parseFloat(e)))&&parseFloat(e)},checkInt:function(e){return!(!e||!this.isNumeric(parseInt(e)))&&parseInt(e)},isNumeric:function(e){return!isNaN(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":"/Users/zlebnik/projects/sourcebuster-js/src/js/helpers/uri.js","./terms":"/Users/zlebnik/projects/sourcebuster-js/src/js/terms.js"}],"/Users/zlebnik/projects/sourcebuster-js/src/js/terms.js":[function(e,r,s){"use strict";r.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},["./src/js/sourcebuster.js"])("./src/js/sourcebuster.js")});